<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë–ª–æ–∫—á–µ–π–Ω Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #0f0f0f;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
    }

    header {
      text-align: center;
      padding: 2rem 1rem;
      background: linear-gradient(135deg, #00ff95, #7d3cff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 2.5rem;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 1rem;
    }

    .block {
      background: #1a1a2e;
      border-radius: 10px;
      margin-bottom: 1rem;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 256, 149, 0.2);
    }

    .block-header {
      padding: 1rem;
      font-size: 1.2rem;
      background: #222;
      cursor: pointer;
      color: #00ff95;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .block-content {
      display: none;
      padding: 1rem;
      background: #0f0f0f;
      color: #ccc;
      font-size: 0.95rem;
    }

    .tx {
      background: #222;
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
    }

    .tx-header {
      font-size: 1rem;
      color: #d8b4fe;
      cursor: pointer;
    }

    .tx-content {
      display: none;
      margin-top: 0.5rem;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 0.9rem;
    }

    .btn-refresh {
      display: block;
      margin: 1rem auto;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(45deg, #00ff95, #7d3cff);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 10px #00ff95, 0 0 20px #7d3cff;
      transition: transform 0.2s ease;
    }

    .btn-refresh:hover {
      transform: scale(1.05);
    }

    /* –§–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ */
    .tx-form {
      background: #1a1a2e;
      padding: 1.5rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      box-shadow: 0 0 10px rgba(0, 256, 149, 0.1);
    }

    .tx-form h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #00ff95;
    }

    .tx-form input[type="text"],
    .tx-form input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.2rem;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }

    .tx-form label {
      display: block;
      margin-top: 0.8rem;
      margin-bottom: 0.3rem;
    }

    .tx-form button {
      margin-top: 1rem;
    }
    .tx-form button {
      display: inline-block;
      padding: 0.6rem 1.2rem;
      background: linear-gradient(45deg, #00ff95, #7d3cff);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px #00ff95, 0 0 20px #7d3cff;
      transition: all 0.3s ease;
    }

    .tx-form button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00ff95, 0 0 25px #7d3cff;
    }

    .tx-form button:active {
      transform: scale(0.98);
    }

    #txResult {
      margin-top: 1rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>‚õì –ë–ª–æ–∫—á–µ–π–Ω Explorer</header>
  <div class="container">

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div class="tx-form">
      <h2>üí∏ –ù–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</h2>
      <form id="txForm">
        <div>
          <label>–û—Ç –∫–æ–≥–æ:</label>
          <input type="text" name="From" value="Name 1" required>
        </div>
        <div>
          <label>–ö–æ–º—É:</label>
          <input type="text" name="To" value="Name 2" required>
        </div>
        <div>
          <label>–°—É–º–º–∞:</label>
          <input type="number" step="0.01" name="Amount" value="10.0" required>
        </div>
        <div>
          <label>
            <input type="checkbox" name="IsPrivate" value="true">
            üîê –ü—Ä–∏–≤–∞—Ç–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
          </label>
        </div>
        <button type="submit">‚ûï –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
      <div id="txResult"></div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
    <button class="btn-refresh" onclick="fetchBlocks()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>

    <!-- –ë–ª–æ–∫–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div id="blocks"></div>
  </div>

  <script>
    async function fetchBlocks() {
      const container = document.getElementById('blocks');
      container.innerHTML = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...';

      try {
        const response = await fetch('http://localhost:8081/blocks');
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤');

        const blocks = await response.json();
        container.innerHTML = '';

        blocks.forEach(block => {
          const blockEl = document.createElement('div');
          blockEl.className = 'block';

          const header = document.createElement('div');
          header.className = 'block-header';
          header.textContent = 'üì¶ –ë–ª–æ–∫ #' + block.index + ' ‚Äî ' + block.hash;

          const content = document.createElement('div');
          content.className = 'block-content';

          const timestamp = document.createElement('div');
          timestamp.innerHTML = '<strong>üìÖ Timestamp:</strong> ' + new Date(block.timestamp * 1000).toLocaleString();

          const txCount = document.createElement('div');
          txCount.innerHTML = '<strong>üßæ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:</strong> ' + block.transactions.length;

          const validator = document.createElement('div');
          validator.innerHTML = '<strong>üßë Validator:</strong> ' + block.validator;

          content.appendChild(timestamp);
          content.appendChild(txCount);
          content.appendChild(validator);

          if (block.transactions.length > 0) {
            block.transactions.forEach(tx => {
              const txEl = document.createElement('div');
              txEl.className = 'tx';

              const txHeader = document.createElement('div');
              txHeader.className = 'tx-header';
              txHeader.textContent = 'üìÑ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ' + tx.ID;

              const txContent = document.createElement('div');
              txContent.className = 'tx-content';

              const txTime = new Date(tx.Timestamp * 1000).toLocaleString();

              txContent.innerHTML = `
                <div><strong>üî¢ ID:</strong> ${tx.ID}</div>
                <div><strong>üßë –û—Ç:</strong> ${tx.From}</div>
                <div><strong>üßç –ö–æ–º—É:</strong> ${tx.To}</div>
                <div><strong>üí∞ –°—É–º–º–∞:</strong> ${tx.Amount}</div>
                <div><strong>üìÖ –í—Ä–µ–º—è:</strong> ${txTime}</div>
                <div><strong>üìù –ü–æ–¥–ø–∏—Å—å:</strong> ${tx.Signature}</div>
                <div><strong>üîê IsPrivate:</strong> ${tx.IsPrivate ? '–î–∞' : '–ù–µ—Ç'}</div>
              `;

              txHeader.addEventListener('click', () => {
                txContent.style.display = txContent.style.display === 'block' ? 'none' : 'block';
              });

              txEl.appendChild(txHeader);
              txEl.appendChild(txContent);
              content.appendChild(txEl);
            });
          }

          blockEl.appendChild(header);
          blockEl.appendChild(content);
          container.appendChild(blockEl);

          header.addEventListener('click', () => {
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
          });
        });
      } catch (e) {
        container.innerHTML = '<div style="color:red">‚ùå –û—à–∏–±–∫–∞: ' + e.message + '</div>';
      }
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    fetchBlocks();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('txForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);

      const resultEl = document.getElementById('txResult');
      resultEl.innerHTML = 'üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...';

      try {
        const response = await fetch('http://localhost:8000/addtx', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const text = await response.text();
        if (response.ok) {
          resultEl.innerHTML = `<div style="color: #00ff95;">${text}</div>`;
          form.reset();
          fetchBlocks(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤
        } else {
          resultEl.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${text}</div>`;
        }
      } catch (e) {
        resultEl.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${e.message}</div>`;
      }

      return false; // ‚¨ÖÔ∏è –Ø–≤–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É
    });
  </script>
</body>
</html>